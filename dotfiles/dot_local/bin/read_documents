#!/usr/bin/env zsh
# read_documents: pick and open a document from ~/dw (rofi -> zathura)
# Usage: read_documents [extra rofi args]

IFS=$'\n\t'
if [[ "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
  sed -n '2,3p' "$0" | sed 's/^# \{0,1\}//'; exit 0
fi

command -v rofi >/dev/null 2>&1 || { print -u2 'read_documents: rofi not found'; :; }
command -v fd >/dev/null 2>&1 || { print -u2 'read_documents: fd not found'; :; }
command -v zathura >/dev/null 2>&1 || { print -u2 'read_documents: zathura not found'; :; }

fd . ~/dw/ -d 1 -t f -0 -e pdf -e djvu -e epub \
  | xargs -0 -n1 \
  | rofi -auto-select -modi file-browser-extended -show file-browser-extended \
      -file-browser-dir "~/dw" -file-browser-depth 1 \
      -file-browser-open-multi-key "kb-accept-alt" \
      -file-browser-open-custom-key "kb-custom-11" \
      -file-browser-hide-hidden-symbol "" \
      -file-browser-only-files \
      -file-browser-stdin \
      -file-browser-path-sep "/" -theme clip.rasi \
      -file-browser-cmd 'zathura' "$@"
